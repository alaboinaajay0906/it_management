{% extends 'base.html' %}
{% block title %}Server Form{% endblock %}

{% block content %}
<style>
    .gradient-bg {
        background: linear-gradient(135deg, #6e8efb 0%, #a777e3 100%);
    }
    .form-card {
        border: none;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    }
    .form-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0,0,0,0.15);
    }
    .form-header {
        background: linear-gradient(90deg, #ff758c 0%, #ff7eb3 100%);
        color: white;
        padding: 1.5rem;
    }
    .form-control:focus {
        border-color: #a777e3;
        box-shadow: 0 0 0 0.25rem rgba(167, 119, 227, 0.25);
    }
    .btn-submit {
        background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
        border: none;
        font-weight: 600;
    }
    .btn-submit:hover {
        background: linear-gradient(90deg, #3a7bd5 0%, #00d2ff 100%);
        transform: translateY(-2px);
    }
    .btn-back {
        background: linear-gradient(90deg, #fdfbfb 0%, #ebedee 100%);
        border: none;
        color: #6e8efb;
        font-weight: 600;
    }
    .status-select {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 8px;
        border: 2px solid #e9ecef;
    }
    .form-label {
        color: #495057;
        font-weight: 600;
    }
    .notes-field {
        background-color: #f8f9fa;
        border-radius: 10px;
    }
</style>


<!-- Flash messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}


<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="form-card">
                <div class="form-header text-center">
                    <h2><i class="fas fa-server me-2"></i> Server Configuration details</h2>
                    <p class="mb-0">Manage your server details with ease</p>
                </div>
                
                <div class="card-body p-4">

<!-- ✅ Import & Sample Excel Buttons with color -->
<div class="mb-4 d-flex justify-content-end gap-2">
    <a href="{{ url_for('main.import_servers') }}" class="btn btn-success btn-sm shadow-sm px-3 py-2">
        <i class="fas fa-file-upload me-1"></i> Import from Excel
    </a>
    <a href="{{ url_for('static', filename='sample_import.xlsx') }}" class="btn btn-primary btn-sm shadow-sm px-3 py-2">
        <i class="fas fa-file-excel me-1"></i> Download Sample Excel
    </a>
</div>

    <form method="POST" class="needs-validation" novalidate>

                        {{ form.hidden_tag() }}
                        
<!-- Existing Name, Machine Password, and OS Row -->
<div class="row g-3 mb-4">
    <!-- Machine Name -->
    <div class="col-md-4">
        <div class="form-floating">
            {{ form.name(class="form-control", id="nameInput", placeholder=" ") }}
            <label for="nameInput" class="form-label">
                <i class="fas fa-tag me-2 text-primary"></i>{{ form.name.label.text }}
            </label>
            {% if form.name.errors %}
                <small class="text-danger">{{ form.name.errors[0] }}</small>
            {% endif %}
        </div>
    </div>

    <!-- Machine Password -->
<div class="col-md-4">
    <div class="form-floating">
        {{ form.machine_psw(class="form-control", id="machinePasswordInput", placeholder=" ", autocomplete="off") }}
        <label for="machinePasswordInput" class="form-label">
            <i class="fas fa-key me-2 text-warning"></i>{{ form.machine_psw.label.text }}
        </label>
        <small class="text-muted">Don't Leave blank this field</small>
        {% if form.machine_psw.errors %}
            <small class="text-danger">{{ form.machine_psw.errors[0] }}</small>
        {% endif %}
    </div>
</div>

    <!-- Operating System -->
    <div class="col-md-4">
        <div class="form-floating">
            {{ form.os(class="form-select", id="osSelect", placeholder=" ") }}
            <label for="osSelect" class="form-label">
                <i class="fab fa-windows me-2 text-info"></i>{{ form.os.label.text }}
            </label>
            {% if form.os.errors %}
                <small class="text-danger">{{ form.os.errors[0] }}</small>
            {% endif %}
        </div>
    </div>
</div>

<!-- ✅ Machine ID & Machine Code -->
<div class="row g-3 mb-4">
    <div class="col-md-6">
        <div class="form-floating">
            {{ form.machine_id(class="form-control", id="machineIdInput", placeholder=" ") }}
            <label for="machineIdInput" class="form-label">
                <i class="fas fa-barcode me-2 text-success"></i>{{ form.machine_id.label.text }}
            </label>
        </div>
    </div>
    <div class="col-md-6">
        <div class="form-floating">
            {{ form.machine_code(class="form-control", id="machineCodeInput", placeholder=" ") }}
            <label for="machineCodeInput" class="form-label">
                <i class="fas fa-hashtag me-2 text-danger"></i>{{ form.machine_code.label.text }}
            </label>
        </div>
    </div>
</div>

<!-- ✅ Specifications Field -->
<div class="row g-3 mb-4">
    <div class="col-12">
        <div class="form-floating">
            {{ form.specifications(class="form-control", id="specificationsInput", style="height: 120px;", placeholder=" ") }}
            <label for="specificationsInput" class="form-label">
                <i class="fas fa-list me-2 text-warning"></i>{{ form.specifications.label.text }}
            </label>
        </div>
    </div>
</div>
                        
                        <!-- IP & Owner Row -->
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <div class="form-floating">
                                    {{ form.ip_address(class="form-control", id="ipInput", placeholder=" ") }}
                                    <label for="ipInput" class="form-label">
                                        <i class="fas fa-network-wired me-2 text-success"></i>{{ form.ip_address.label.text }}
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    {{ form.owner(class="form-control", id="ownerInput", placeholder=" ") }}
                                    <label for="ownerInput" class="form-label">
                                        <i class="fas fa-user-tie me-2 text-warning"></i>{{ form.owner.label.text }}
                                    </label>
                                </div>
                            </div>
                        </div>
                        <!-- Status Field (SelectField) -->
                        <div class="col-md-6">
                            <div class="form-floating">
                                {{ form.status(class="form-control", id="statusInput", placeholder=" ") }}
                                <label for="statusInput">
                                    <i class="fas fa-heartbeat me-2 text-danger"></i>{{ form.status.label.text }}
                                </label>
                            </div>
                        </div>
                        <!-- Department Field (SelectField) -->
                        <div class="mb-4">
                            <label class="form-label">
                                <i class="fas fa-building me-2 text-primary"></i>{{ form.department.label.text }}
                            </label>
                            {{ form.department(class="form-select py-3") }}
                        </div>

                        <!-- purpse Field (SelectField) -->
                        <div class="mb-4">
                            <label class="form-label">
                                <i class="fas fa-stethoscope me-2 text-info"></i>{{ form.purpose.label.text }}
                            </label>
                            {{ form.purpose(class="form-select py-3") }}
                        </div>

                        <!-- Primary Email ID Field (StringField) -->
                        <div class="mb-4">
                            <label class="form-label">
                                <i class="fas fa-envelope me-2 text-warning"></i>{{ form.email_id_prim.label.text }}
                            </label>
                            {{ form.email_id_prim(class="form-control py-3", placeholder="Enter primary email ID (you can add multiple email_id with ',')") }}
                        </div>   
                         <div class="form-group">

<!-- Improved Notification Fields -->
<div class="row g-3 mb-4">
    <div class="col-md-6">
        <div class="form-floating">
            <select class="form-control" id="notification_mode" name="notification_mode" required>
                {% for value, label in form.notification_mode.choices %}
                    <option value="{{ value }}" {% if form.notification_mode.data == value %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
            <label for="notification_mode">
                <i class="fas fa-bell me-2 text-warning"></i>Notification Mode
            </label>
        </div>
    </div>
    <div class="col-md-6" id="notify_interval_group" style="display: {% if form.notification_mode.data == 1 %}block{% else %}none{% endif %};">
        <div class="form-floating">
            <input type="number" class="form-control" id="notify_interval" name="notify_interval" 
                   value="{{ form.notify_interval.data if form.notify_interval.data }}" min="1">
            <label for="notify_interval">
                <i class="fas fa-clock me-2 text-info"></i>Notify Interval (min)
            </label>
            {% if form.notify_interval.errors %}
                <div class="invalid-feedback" style="display: block;">
                    {{ form.notify_interval.errors[0] }}
                </div>
            {% endif %}
        </div>
    </div>
</div>

                        <!-- Notes Field -->
                        <div class="mb-4">
                            <label class="form-label">
                                <i class="fas fa-sticky-note me-2 text-purple"></i>{{ form.notes.label.text }}
                            </label>
                            {{ form.notes(class="form-control notes-field py-3", rows="4", placeholder="Enter important notes about this server...") }}
                        </div>
                        
                        <!-- Form Buttons -->
                        <div class="d-flex justify-content-between mt-4">
                            <a href="{{ url_for('main.dashboard') }}" class="btn btn-back btn-lg px-4">
                                <i class="fas fa-arrow-left me-2"></i> Back
                            </a>
                            <button type="submit" class="btn btn-submit btn-lg px-4 text-white">
                                <i class="fas fa-save me-2"></i> {{ form.submit.label.text }}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Fixed JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Bootstrap Form Validation
    const forms = document.querySelectorAll('.needs-validation');
    Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);
    });

    // Notification Interval Toggle
    document.getElementById('notification_mode').addEventListener('change', function() {
        const intervalGroup = document.getElementById('notify_interval_group');
        intervalGroup.style.display = (this.value === '1') ? 'block' : 'none';
        
        // Add validation requirement when visible
        document.getElementById('notify_interval').required = (this.value === '1');
    });
    
    // Initialize on load
    const modeSelect = document.getElementById('notification_mode');
    if (modeSelect) {
        modeSelect.dispatchEvent(new Event('change'));
    }
});
</script>

{% endblock %}